# Proof of Concept: Magic Craft

## Game Design Document

---

## 1. Обзор проекта

**Magic Craft** — это roguelite с видом сверху в жанре arena shooter. Игрок сражается с волнами врагов, используя магические заклинания, которые он сам крафтит и улучшает по ходу игры.

Ключевая особенность проекта заключается в уникальной системе крафта магии. В отличие от большинства roguelite-игр, где игрок получает готовые апгрейды или выбирает из предложенных вариантов, в Magic Craft магия создаётся через систему крафта, вдохновлённую механиками Path of Exile. Игрок не изучает заклинания — он их крафтит, добавляя и модифицируя аффиксы на базовых заклинаниях.

### Основные характеристики

**Жанр:** Roguelite Arena Shooter с видом сверху

**Платформа:** PC (Steam)

**Целевая аудитория:** Игроки, которым нравятся roguelite-игры в духе Vampire Survivors и Halls of Torment, а также фанаты глубоких крафт-систем из игр вроде Path of Exile. Проект объединяет доступный геймплей survivor-like игр с глубиной и вариативностью сложных крафт-механик.

**Монетизация:** Premium модель, ценовой диапазон $10-20. Никаких внутриигровых покупок или DLC на старте.

**Мультиплеер:** Отсутствует. Игра разрабатывается исключительно как singleplayer-опыт.

---

## 2. Ключевая концепция

### Философия дизайна

Центральная идея Magic Craft выражается в одной фразе: **"Магия не изучается — магия крафтится."**

В типичных roguelite-играх игрок получает апгрейды в готовом виде: выбрал один из трёх вариантов — получил новую способность или усиление. Это создаёт ощущение пассивного накопления силы. Magic Craft переворачивает эту парадигму: игрок активно участвует в создании своего билда через систему крафта.

Каждое заклинание начинается как простая база и постепенно обрастает аффиксами — модификаторами, которые меняют его поведение, урон, скорость и другие характеристики. Игрок не просто "получает +1 к проджектайлам" — он решает, принять ли этот аффикс на конкретное заклинание, понимая, что это увеличит стоимость каста и займёт слот для других модификаторов.

### Основной игровой цикл

Игровая сессия (ран) строится вокруг чередования боевых волн и фаз крафта:

1. **Подготовка к рану.** Перед началом игрок выбирает четыре базовых заклинания из разблокированного пула — по одному для каждого слота. Этот выбор определяет стартовую стратегию и возможные направления развития билда.

2. **Боевая волна.** Игрок сражается с толпами врагов на арене. За прохождение волны игрок получает золото. Волна заканчивается, когда игрок убивает определённое количество врагов.

3. **Фаза крафта.** Между волнами все накопленные валюты автоматически конвертируются в предложения крафта. Система Rog (названная в честь NPC из Path of Exile: Expedition) последовательно показывает игроку, какие модификации можно применить к заклинаниям. Игрок принимает или отклоняет каждое предложение.

4. **Прогрессия.** С каждой волной сложность растёт: враги становятся сильнее и многочисленнее. Каждые пять волн игрок встречает босса. Ран продолжается до победы над финальным боссом или до смерти игрока.

5. **Мета-прогрессия.** После завершения рана (успешного или нет) игрок может разблокировать новый контент: базы заклинаний, типы крафт-валют, уровни сложности. Важно: мета-прогрессия не даёт численных преимуществ — только расширяет доступные опции.

---

## 3. Управление и базовые механики

### Схема управления

Игра использует twin-stick управление, адаптированное под клавиатуру и мышь:

**Движение** осуществляется клавишами WASD. Персонаж может двигаться в восьми направлениях с постоянной скоростью. Скорость передвижения может быть увеличена через аффиксы на Support-заклинаниях.

**Прицеливание** выполняется мышью. Персонаж всегда повёрнут в сторону курсора, что позволяет стрелять в одном направлении, двигаясь в другом.

**Активное заклинание** кастуется левой кнопкой мыши. Это основной источник урона, который игрок контролирует напрямую. Каст тратит ману, стоимость которой зависит от количества и силы аффиксов на заклинании.

**Защитное заклинание** активируется клавишей Space или Shift. Это может быть Dash (рывок с iframes), Magic Shield (временная защита) или другое защитное заклинание. Конкретное поведение зависит от выбранной базы защитного заклинания.

### Ресурсы персонажа

**Здоровье (HP)** — целочисленный ресурс в малых количествах. Игрок начинает ран с **3 HP**. Максимум HP может быть увеличен через аффиксы или артефакты.

После получения урона игрок получает короткий период **неуязвимости (iframes)**, что предотвращает мгновенную смерть от нескольких источников урона.

**HP не регенерирует** во время волны. Вместо этого в конце каждой волны оставшиеся HP конвертируются в золото (1 HP = X золота). Это создаёт стратегический выбор: рисковать здоровьем ради сохранения золота или играть осторожно. Дополнительные источники восстановления (вампиризм, лечение) доступны через аффиксы и артефакты.

**Мана** тратится только на Active Spell — основное атакующее заклинание. Каждый аффикс на Active Spell увеличивает стоимость каста через множитель. Множитель зависит как от типа аффикса (мощные эффекты вроде дополнительных проджектайлов стоят дороже), так и от его tier'а (более сильные версии аффикса стоят больше).

Пример расчёта стоимости маны:
```
Base cost: 10 mana
+1 projectile (Tier 1): ×1.3
+20% fire damage (Tier 2): ×1.15
+10% cast speed (Tier 3): ×1.1
Pierce (Tier 2): ×1.2
Итого: 10 × 1.3 × 1.15 × 1.1 × 1.2 ≈ 19.7 mana
```

Мана регенерирует со временем. Если мана закончилась, игрок просто ждёт регена — Active Spell не кастуется без маны. Дополнительные источники регена маны (при убийстве, при получении урона и т.д.) доступны через аффиксы.

Важный дизайнерский момент: Passive Spell и Support работают бесплатно. Аффиксы на этих заклинаниях не увеличивают никакой стоимости. Это создаёт асимметрию: Active Spell требует баланса между силой и ценой каста, тогда как остальные два заклинания ограничены только количеством слотов под аффиксы.

---

## 4. Боевая система

### Общий подход к бою

Бой в Magic Craft построен на принципе "толпа против одного". Враги нападают большими группами, и задача игрока — эффективно уничтожать их, используя все четыре заклинания в комбинации. Уклонение через Defensive Spell и грамотное позиционирование критически важны для выживания.

Вся игра проходит на одной арене. Арена не меняется между волнами — это упрощает дизайн и позволяет игроку сфокусироваться на совершенствовании билда, а не на изучении новых локаций.

### Типы врагов

> Приведённые ниже типы врагов являются примерами. Финальный список будет расширяться и балансироваться в процессе разработки.

Враги делятся на базовые архетипы по поведению:

**Melee** — простейший тип врагов. Бегут напрямую к игроку и атакуют в ближнем бою. Опасны в больших количествах, когда могут окружить игрока.

**Ranged** — дистанционные враги. Держат дистанцию и стреляют проджектайлами. Требуют приоритетного уничтожения или уклонения от их снарядов.

**Tank** — медленные, но очень живучие враги. Много HP, низкая скорость. Создают препятствия и требуют времени на уничтожение.

**Fast** — быстрые и хрупкие. Мало здоровья, но высокая скорость делает их сложными целями. Могут быстро добраться до игрока.

**Swarm** — очень слабые враги, появляющиеся в огромных количествах. По отдельности не опасны, но масса может перегрузить игрока.

### Элементальная система

Каждый архетип врага может иметь элементальную версию: Fire, Cold или Lightning. Элементальные враги обладают резистом к соответствующему типу урона. Fire Tank получает меньше урона от огненных заклинаний, Cold Ranged сопротивляется холоду и так далее.

Важно: в игре нет элементального треугольника. Огонь не бьёт лёд сильнее, молния не имеет преимущества над чем-либо. Система проста: есть резист или нет резиста. Это упрощает понимание механики и не заставляет игрока собирать "правильный" элемент — достаточно иметь разнообразие или сфокусироваться на физическом уроне.

---

## 5. Система волн

### Структура волны

Игра построена на волновой системе, похожей на Brotato. Это создаёт чёткий ритм: бой → магазин → бой → магазин.

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   WAVE 1    │ ──► │    SHOP     │ ──► │   WAVE 2    │ ──► ...
│  (Combat)   │     │  (Buy/Craft)│     │  (Combat)   │
└─────────────┘     └─────────────┘     └─────────────┘
```

### Механика спавна врагов

Каждая волна имеет два ключевых параметра:
- **Total enemies** — общее количество врагов, которых нужно убить (например, 50)
- **Max concurrent** — максимум врагов на арене одновременно (например, 6)

Система поддерживает количество врагов на арене: после убийства врага проходит короткая пауза (~0.5 сек), затем спавнится новый. Волна заканчивается, когда убиты все враги из total count.

Чем сильнее билд — тем быстрее игрок проходит волну. Бонуса за скорость нет, это просто экономия реального времени игрока.

С каждой волной сложность растёт: увеличивается total enemies и max concurrent, враги получают больше HP и урона, появляются более опасные типы.

### Боссы

Каждые пять волн (волна 5, 10, 15 и так далее) игрок встречает босса. Босс-файт происходит на отдельной арене и представляет собой проверку текущего билда.

Ключевая особенность: игрок заранее знает, какой босс будет следующим. На протяжении волн 1-4 на экране отображается информация о боссе волны 5: его имя, резисты, тип атак. Это позволяет целенаправленно готовиться — например, если следующий босс имеет Fire Resist, игрок может отклонять огненные аффиксы и искать холод или молнию.

```
Волны 1-4: На экране: "Next Boss: Flame Guardian (Fire Resist, AoE attacks)"
           Игрок учитывает это при принятии крафт-решений
Волна 5:   Boss Fight
Волны 6-9: На экране информация о следующем боссе
Волна 10:  Boss Fight
...
```

### Почему волны, а не continuous

Выбор в пользу волновой системы (вместо continuous gameplay как в Vampire Survivors) обусловлен спецификой крафт-механики:

Чёткая точка для принятия решений — между волнами игрок может спокойно обдумать каждое крафт-предложение, не отвлекаясь на бой.

Сохранение combat flow — во время боя нет пауз на крафт. Игрок полностью сфокусирован на сражении.

Возможность оценки — перед началом новой волны игрок может оценить свой текущий билд и понять, чего не хватает.

---

## 6. Система магии

### Структура заклинания

Каждое заклинание состоит из двух компонентов:

**База** — определяет фундаментальное поведение заклинания. Magic Arrow летит по прямой и наносит урон первой цели. Fireball летит и взрывается при попадании. Rain of Fire периодически создаёт снаряды, падающие с неба в случайных местах. База выбирается перед началом рана и не может быть изменена в процессе.

**Аффиксы** — модификаторы, которые меняют характеристики и поведение базы. Каждое заклинание начинается с фиксированным количеством **пустых слотов** под аффиксы. Орбы меняют аффикс в случайном слоте — неважно, пустой он или уже заполнен. Это упрощает механику: нет разницы между "заполнить пустой" и "перезаписать существующий". Каждый аффикс уникален — нельзя иметь два одинаковых аффикса на одном заклинании, но можно улучшить tier существующего.

Количество аффиксов ограничено (точное число будет определено при балансировке, но планируется более 6 слотов). Возможно введение дополнительных категорий модификаторов: имплиситы (встроенные в базу), энчанты (временные усиления) — это будет решено в процессе разработки.

### Четыре слота заклинаний

Игрок одновременно использует четыре заклинания, каждое в своём слоте:

**Active Spell** — основное атакующее заклинание, управляемое игроком напрямую. Кастуется по нажатию ЛКМ, направляется курсором мыши. Это единственное заклинание, которое тратит ману. Примеры баз: Magic Arrow (простой проджектайл), Fireball (AoE при попадании), Lightning Bolt (мгновенный удар).

**Passive Spell** — автоматическое заклинание, работающее без участия игрока. Оно постоянно активно и производит эффекты самостоятельно. Примеры баз: Orbiting Sparks (снаряды вращаются вокруг игрока), Rain of Fire (снаряды падают с неба в случайных местах), Pulse Nova (периодический AoE вокруг игрока).

**Support Spell** — универсальный слот для заклинаний поддержки. Сюда входят любые способности, которые не атакуют напрямую и не являются чисто защитными: ауры (баффы игроку), проклятия (дебаффы врагам), миньоны и другие вспомогательные эффекты. Примеры баз: Haste (увеличение скорости движения), Weakness Aura (враги в радиусе получают больше урона), Summon Familiar (призыв существа-помощника), Mana Siphon (восстановление маны при убийстве).

**Defensive Spell** — защитное заклинание, активируемое игроком по нажатию Space/Shift. Имеет кулдаун. Примеры баз: Dash (рывок с iframes, позволяет проходить сквозь врагов и снаряды), Magic Shield (временный барьер, поглощающий урон), Blink (мгновенная телепортация на короткую дистанцию).

Все четыре заклинания работают одновременно и постоянно (кроме Active, который требует нажатия кнопки и траты маны, и Defensive, который требует активации и имеет кулдаун). Это создаёт комплексный билд, где каждый компонент вносит свой вклад.

### Синергии между заклинаниями

В игре нет hardcoded синергий — нет бонуса за использование "полного fire-сета" или штрафа за смешивание элементов. Вместо этого синергии создаются органически через аффиксы.

Пример: Support с аффиксом "накладывает поджог на врагов в радиусе" помечает врагов статусом горения. Active Spell с аффиксом "увеличенный урон по горящим врагам" наносит больше урона этим целям. Игрок сам создаёт эту комбинацию через крафт.

Другой пример: Support даёт бонус к шансу критического удара всем заклинаниям. Passive Spell накладывает замедление, а Active имеет бонусный урон по замедленным целям.

Такой подход даёт огромную вариативность билдов и награждает игроков за понимание системы.

### Типы урона

Заклинания могут наносить физический или элементальный урон (Fire, Cold, Lightning). Базовые заклинания обычно наносят физический урон, но аффиксы могут конвертировать его в элементальный. Заклинание может иметь смешанный урон — например, 50% физического и 50% огненного.

Критические удары присутствуют в игре. Базовый шанс крита и множитель крита низкие, но могут быть значительно увеличены через аффиксы.

---

## 7. Экономика и магазин

### Золото

Золото — единственная валюта в игре. Игрок получает золото за прохождение волн. Золото существует в небольших количествах:

- **100 золота** — это много, такое количество накапливается к поздним волнам
- **10-20 золота** — типичный бюджет в начале игры
- **1 золото** — стоимость базовых предметов

Враги не роняют лут. Битва — это чистая проверка текущего билда. Иногда на арене могут появляться сундуки, алтари и другие интерактивные объекты, влияющие на награду за волну, но это редкие события.

### Магазин между волнами

После каждой волны открывается магазин. По умолчанию предлагается **3 товара**:
- **1 артефакт**
- **2 орба** (крафт-валюты)

Игрок может купить любое количество предложенных товаров (если хватает золота) или пропустить покупку.

**Реролл предложений:** если текущие товары не устраивают, можно реролить магазин за золото. Стоимость реролла увеличивается с каждым использованием в рамках одной фазы магазина. После перехода к следующей волне стоимость реролла сбрасывается.

```
Первый реролл:  1 золото
Второй реролл:  2 золота
Третий реролл:  3 золота
...
```

### Покупка орбов

При покупке орба игрок сразу применяет его:

1. Игрок покупает орбу
2. Выбирает, на какое из четырёх заклинаний применить
3. Система показывает результат — какой аффикс будет добавлен
4. Игрок решает: **Apply** (применить) или **Discard** (отклонить)

**Apply** — крафт применяется к заклинанию, орба потрачена.

**Discard** — орба не применяется, но золото уже потрачено. Это риск покупки — иногда результат не подходит.

Это решает главную проблему крафта в roguelite: риск испортить билд одним неудачным решением. Игрок всегда видит результат до принятия решения и может отказаться (хотя золото не возвращается).

### Пример сессии магазина

После волны 3 игрок заработал 8 золота. Открывается магазин:

```
┌──────────────────────────────────────────────────────────┐
│ SHOP                                    Gold: 8          │
├──────────────────────────────────────────────────────────┤
│ [1] Vampiric Fang (Artifact)           - 6 gold          │
│     5% lifesteal on all damage                           │
│                                                          │
│ [2] Shard of Change (Orb)              - 2 gold          │
│     Changes random affix                                 │
│                                                          │
│ [3] Ember (Orb)                        - 3 gold          │
│     Changes random affix to fire                         │
├──────────────────────────────────────────────────────────┤
│ [REROLL - 1 gold]              [CONTINUE TO NEXT WAVE]   │
└──────────────────────────────────────────────────────────┘
```

Игрок покупает Shard of Change за 2 золота:

```
┌──────────────────────────────────────────────────────────┐
│ Shard of Change                                          │
├──────────────────────────────────────────────────────────┤
│ Select spell: [Active] [Passive] [Support] [Defensive]  │
└──────────────────────────────────────────────────────────┘

> Игрок выбирает Active Spell

┌──────────────────────────────────────────────────────────┐
│ Shard of Change → ACTIVE SPELL                           │
├──────────────────────────────────────────────────────────┤
│ Result: "+1 projectile"                                  │
│                                                          │
│              [APPLY]    [DISCARD]                        │
└──────────────────────────────────────────────────────────┘

> Apply — аффикс добавлен!
```

Игрок возвращается в магазин с 6 золотыми. Артефакт Vampiric Fang стоит ровно 6 — можно купить, но не останется денег на реролл. Игрок решает реролить:

```
┌──────────────────────────────────────────────────────────┐
│ SHOP                                    Gold: 5          │
├──────────────────────────────────────────────────────────┤
│ [1] Lucky Coin (Artifact)              - 4 gold          │
│     +15% gold from waves                                 │
│                                                          │
│ [2] Prism (Orb)                        - 5 gold          │
│     Choose 1 of 3 random affixes                         │
│                                                          │
│ [3] Shard of Chaos (Orb)               - 2 gold          │
│     Reroll all affixes                                   │
├──────────────────────────────────────────────────────────┤
│ [REROLL - 2 gold]              [CONTINUE TO NEXT WAVE]   │
└──────────────────────────────────────────────────────────┘
```

Теперь игрок видит Lucky Coin — артефакт, увеличивающий золото. Это хорошая инвестиция на ранних волнах!

Таймер на принятие решения отсутствует. Игрок может думать столько, сколько нужно.

### Прогрессия магазина

Чем дальше игрок продвигается в ране, тем интереснее становится ассортимент магазина:

**Ранние волны (1-5):** в магазине появляются только дешёвые орбы (Shard of Change, Shard of Chaos) и простые артефакты. Цены низкие, но и эффекты базовые.

**Средние волны (6-10):** открываются элементальные орбы (Ember, Rime, Spark), орбы улучшения tier'а, более интересные артефакты. Цены растут, но и возможности шире.

**Поздние волны (11+):** появляются редкие орбы с точным контролем (Prism, Fracture), мощные артефакты. Высокие цены, но и максимальный контроль над билдом.

Это награждает игрока за продвижение — чем дольше он выживает, тем больше возможностей для тонкой настройки билда.

### Типы крафт-валют (орбы)

> Приведённые валюты являются примерами. Финальный список будет расширяться и балансироваться в процессе разработки.

**Common орбы** (1-2 золота) — базовые операции:
- Shard of Change — меняет случайный аффикс
- Shard of Chaos — реролл всех аффиксов

**Uncommon орбы** (3-4 золота) — элементальный контроль:
- Ember — меняет случайный аффикс на fire-аффикс
- Rime — меняет случайный аффикс на cold-аффикс
- Spark — меняет случайный аффикс на lightning-аффикс

**Rare орбы** (5-8 золота) — точный контроль:
- Prism — выбор одного из трёх случайных аффиксов
- Fracture — реролл с сохранением префиксов или суффиксов

### Мета-крафт орбы (Omens)

Мета-крафт орбы (Omens) — особый тип валют, вдохновлённый механикой Omens из Path of Exile 2. В отличие от обычных орб, Omens **не изменяют аффиксы напрямую**. Вместо этого они модифицируют, как будет применена **следующая** орба к этому заклинанию.

**Механика работы:**

1. Игрок применяет Omen к выбранному заклинанию
2. Omen "заряжает" это заклинание — оно получает pending-эффект
3. Игрок продолжает обрабатывать очередь орб
4. Когда игрок применяет любую обычную орбу к "заряженному" заклинанию, Omen модифицирует результат
5. После срабатывания Omen-эффект исчезает

**Ключевая особенность:** игрок не обязан сразу использовать следующую орбу на заряженном заклинании. Он может подождать нужную орбу в очереди, чтобы максимизировать эффект. Например: применить Omen of Suffix к Active Spell, затем пропустить несколько слабых орб (применив их на другие заклинания), и дождаться мощной Prism, чтобы получить гарантированный выбор из трёх суффиксов.

> Приведённые Omens являются примерами. Финальный список будет расширяться и балансироваться в процессе разработки.

**Omens контроля типа аффикса:**
- Omen of Prefix — следующий аффикс гарантированно будет префиксом
- Omen of Suffix — следующий аффикс гарантированно будет суффиксом

**Omens элементального контроля:**
- Omen of Flame — следующий аффикс будет из пула fire-модов
- Omen of Frost — следующий аффикс будет из пула cold-модов
- Omen of Storm — следующий аффикс будет из пула lightning-модов

**Omens качества:**
- Omen of Fortune — следующий аффикс будет максимального tier'а для текущей волны
- Omen of Choice — следующая орба предложит выбор из 3 вариантов (даже если это обычный Shard)

**Omens защиты:**
- Omen of Preservation — следующий крафт не удалит существующие аффиксы (полезно при реролле)

**Стратегическая глубина:**

Видимая очередь орб критически важна для работы с Omens. Игрок может:
- Увидеть редкую орбу в конце очереди и заранее "зарядить" нужное заклинание Omen'ом
- Применить несколько Omens к разным заклинаниям, а затем распределять подходящие орбы
- Пропустить слабые орбы, сохраняя Omen-эффект для более ценной валюты

Это создаёт дополнительный слой планирования поверх базовой механики крафта.

### Примеры аффиксов

> Приведённые аффиксы являются примерами. Финальный список будет расширяться и балансироваться в процессе разработки.

**Префиксы** обычно связаны с уроном и скейлингом:
- Converts X% damage to Fire/Cold/Lightning
- +X to projectile count
- +X% damage
- Adds X-Y [element] damage

**Суффиксы** обычно связаны с утилити и скоростью:
- +X% cast speed
- +X% projectile speed
- Pierces X additional targets
- Chains to X enemies
- +X% area of effect
- +X% Gold Find

### Система тиров аффиксов

Каждый аффикс имеет tier — числовое значение, определяющее силу модификатора. Например, "+10% damage" может быть tier 1, а "+50% damage" — tier 5 того же аффикса. Чем выше tier, тем сильнее эффект, но и тем больше мана-мультипликатор для Active Spell.

Возможные tier'ы аффиксов напрямую зависят от номера текущей волны. Формула: **номер волны ± 5 уровней**. Это означает:

- **Волна 1:** tier'ы от 1 до 5 (максимум tier 5)
- **Волна 10:** tier'ы от 5 до 15
- **Волна 15:** tier'ы от 10 до 20
- **Волна 20:** tier'ы от 15 до 25

Минимальный tier всегда 1, даже если формула даёт отрицательное значение. Таким образом, на ранних волнах игрок получает слабые аффиксы, которые постепенно усиливаются по мере продвижения по рану.

Tier аффикса определяется только номером волны.

Существуют специальные валюты, которые модифицируют tier существующего аффикса, не меняя сам аффикс:

> Приведённые валюты являются примерами. Финальный список будет определён в процессе разработки.

- **Upgrade Shard** — повышает tier случайного аффикса на 1
- **Divine Lens** — реролит tier аффикса в пределах текущего диапазона волны
- **Exalted Core** — устанавливает tier аффикса на максимум текущего диапазона

Эти валюты позволяют улучшать ранние аффиксы, которые были приняты на низких волнах, доводя их до актуального уровня силы.

---

## 8. Система артефактов

### Философия: Jokers из Balatro

Артефакты — это особые предметы, вдохновлённые системой Jokers из Balatro. В отличие от аффиксов, которые модифицируют конкретные заклинания, артефакты влияют на **глобальные правила игры** и могут существенно изменить весь геймплей.

Артефакты создают "build-around" моменты — игрок находит интересный артефакт и перестраивает весь билд вокруг него. Это добавляет стратегическую глубину и уникальность каждого рана.

### Получение артефактов

Артефакты покупаются в магазине между волнами. По умолчанию в магазине предлагается 1 артефакт.

**Лимит артефактов:** по умолчанию игрок может иметь максимум **5 артефактов**. Некоторые артефакты или аффиксы могут изменять этот лимит.

**Переполнение инвентаря:** если у игрока уже 5 артефактов и он хочет купить новый, он должен сначала **освободить место**:
- **Выбросить** — артефакт исчезает навсегда
- **Продать** — артефакт продаётся за **половину стоимости** (округление вниз)

Это создаёт значимый выбор: продать старый артефакт за золото или потерять его, но сохранить деньги на другие покупки.

### Порядок артефактов

Артефакты в инвентаре можно менять местами. **Порядок имеет значение** — некоторые артефакты влияют на другие артефакты, и их взаимодействие зависит от позиции.

```
┌─────────────────────────────────────────────────────────┐
│ ARTIFACTS (5/5)                                         │
├─────────────────────────────────────────────────────────┤
│ [1] Chaos Peashooter   - fires chaos bullets on hit     │
│ [2] Amplifier Lens     - doubles effect of next artifact│
│ [3] Vampiric Fang      - 5% lifesteal on all damage     │
│ [4] Lucky Coin         - +15% Gold Find                 │
│ [5] Blindfold          - no Omens, but +rare orb chance │
└─────────────────────────────────────────────────────────┘
```

В примере выше Amplifier Lens удваивает эффект следующего артефакта — значит Vampiric Fang даёт 10% lifesteal вместо 5%. Если поменять их местами, усилится Lucky Coin вместо Fang.

### Примеры артефактов

> Приведённые артефакты являются примерами. Финальный список будет расширяться и балансироваться в процессе разработки.

**Build-around артефакты** — существенно меняют стратегию:

- **Chaos Peashooter** — при любом попадании по врагу выпускает дополнительные хаотические пули. Мотивирует строить билд на chaos damage и частые попадания.
- **Blindfold** — Omens больше не появляются в очереди орбов, но шанс редких орбов значительно увеличен. Трейдофф: теряем контроль над крафтом, но получаем более ценные валюты.
- **Glass Cannon Core** — весь урон удвоен, но HP уменьшено вдвое. Высокий риск — высокая награда.
- **Spell Echo** — каждое заклинание имеет 20% шанс сработать дважды. Синергирует с любым билдом.

**Модификаторы артефактов** — влияют на другие артефакты:

- **Amplifier Lens** — удваивает эффект следующего артефакта в инвентаре.
- **Artifact Duplicator** — при получении нового артефакта создаёт его копию (если есть место).
- **Chaos Infuser** — все артефакты получают дополнительный случайный эффект.

**Крафт-модификаторы** — влияют на систему крафта:

- **Orb Magnet** — +2 орбы за волну.
- **Omen Attractor** — Omens появляются в 2 раза чаще.
- **Tier Booster** — все аффиксы получают +2 к tier'у.
- **Reroll Token** — один раз за фазу крафта можно реролить текущую орбу.

**Боевые артефакты** — прямые боевые бонусы:

- **Vampiric Fang** — 5% от нанесённого урона восстанавливает HP.
- **Thorns Amulet** — отражает 10% полученного урона обратно врагам.
- **Speed Boots** — +20% скорость передвижения.
- **Mana Crystal** — +50% к максимальной мане.

**Рисковые артефакты** — мощные эффекты с недостатками:

- **Cursed Crown** — +100% урон, но -1 слот артефактов.
- **Leaky Mana Potion** — мана регенерирует в 3 раза быстрее, но максимальная мана уменьшена на 30%.
- **Berserker's Rage** — урон увеличивается по мере потери HP (до +100% на 1 HP).

### Редкость артефактов

Артефакты имеют разную редкость, влияющую на частоту появления:

- **Common** — появляются часто, дают небольшие бонусы
- **Uncommon** — умеренные эффекты
- **Rare** — мощные эффекты, появляются редко
- **Legendary** — game-changing эффекты, очень редкие

Редкость артефактов в магазине зависит от номера волны. Редкие артефакты стоят дороже.

### Синергии артефактов и заклинаний

Артефакты создают дополнительный слой синергий поверх системы заклинаний:

**Пример комбо:**
1. Артефакт "Chaos Peashooter" стреляет хаотическими пулями при попадании
2. Active Spell с аффиксом "+3 projectiles" увеличивает количество попаданий
3. Аффикс "+50% chaos damage" усиливает пули от Peashooter
4. Результат: каждый каст Active Spell запускает лавину хаотических пуль

Такие комбо возникают органически и награждают игрока за понимание систем.

---

## 9. Мета-прогрессия

### Философия: Balatro-style

Система мета-прогрессии в Magic Craft следует философии игры Balatro: **разблокировка контента, а не усиление персонажа**.

В отличие от многих roguelite-игр, где мета-прогрессия даёт перманентные бонусы к статам (+5% урона навсегда, +10 HP и т.д.), в Magic Craft нет power creep между ранами. Каждый ран полностью честный — новый игрок и ветеран начинают с одинаковой силой.

Мета-прогрессия расширяет доступные опции: новые базы заклинаний, новые типы крафт-валют, новые уровни сложности. Это даёт разнообразие и реиграбельность без нарушения баланса.

### Разблокировка нового контента

**Новые базы заклинаний** открываются через достижения в игре:

> Приведённые условия являются примерами. Финальный список будет определён в процессе разработки.

- Победил босса волны 10 → разблокировал "Chain Lightning" (Active)
- Убил 1000 врагов Support-заклинанием → разблокировал "Plague" (Support)
- Прошёл ран без Support → разблокировал "Thorns" (Passive)

**Новые крафт-валюты** также требуют выполнения условий:
- Скрафтил заклинание с 6 аффиксами → разблокировал "Prism"
- Отклонил 20 крафтов за ран → разблокировал "Fracture"
- Принял 10 fire-крафтов за ран → разблокировал "Ember"

**Новые артефакты** разблокируются через специфические достижения:
- Нанёс 10000 chaos damage за ран → разблокировал "Chaos Peashooter"
- Прошёл 10 волн с полным HP → разблокировал "Vampiric Fang"
- Выбросил 15 артефактов за все раны → разблокировал "Artifact Duplicator"
- Использовал 50 Omens → разблокировал "Blindfold"

### Выбор заклинаний перед раном

Классы отсутствуют. Перед началом каждого рана игрок свободно выбирает четыре заклинания — по одному для каждого слота — из разблокированного пула:

```
┌──────────────────────────────────────────────────────────┐
│                  SELECT YOUR SPELLS                       │
├──────────────────────────────────────────────────────────┤
│ ACTIVE:    [Magic Arrow] [Fireball] [Lightning Bolt]      │
│ PASSIVE:   [Orbiting Sparks] [Rain of Fire] [🔒]          │
│ SUPPORT:   [Haste] [Weakness Aura] [Familiar] [🔒]        │
│ DEFENSIVE: [Dash] [Magic Shield] [🔒]                     │
├──────────────────────────────────────────────────────────┤
│                      [START RUN]                          │
└──────────────────────────────────────────────────────────┘
```

В начале доступны 1-2 базы в каждой категории. Остальные разблокируются через достижения. Это позволяет игроку самому создавать "классы" через комбинации заклинаний.

### Stakes (уровни сложности)

> Приведённые stakes являются примерами. Финальный список будет расширяться и балансироваться в процессе разработки.

Stakes — это кумулятивные модификаторы сложности, вдохновлённые Balatro. Каждый следующий stake добавляет новый модификатор, не убирая предыдущие:

- **White Stake** — базовая сложность, без модификаторов
- **Red Stake** — враги получают +25% HP
- **Blue Stake** — на одну крафт-валюту меньше за волну
- **Gold Stake** — Rog иногда предлагает "проклятые" крафты с негативным эффектом
- **Purple Stake** — враги наносят +25% урона
- **Orange Stake** — меньше времени на волну
- **Black Stake** — босс появляется каждые 3 волны вместо 5

Прохождение на высоких stakes не даёт геймплейных преимуществ — только признание мастерства и отслеживание в коллекции.

### Challenge Runs

> Приведённые челленджи являются примерами. Финальный список будет расширяться и балансироваться в процессе разработки.

Челленджи — это специальные режимы с предустановленными ограничениями:

- **Minimalist** — максимум 2 аффикса на каждое заклинание
- **Glass Cannon** — x2 наносимого и получаемого урона
- **Chaos Only** — в магазине только Shard of Chaos
- **Solo Mage** — доступен только Active Spell, остальные слоты отключены
- **Support Master** — урон наносит только Support, Active Spell без урона
- **Fire Trial** — только огненный урон разрешён

Некоторые челленджи имеют предвыбранные заклинания, которые нельзя изменить.

### Коллекция

Игра отслеживает прогресс игрока:
- Discovered: X/Y баз заклинаний
- Discovered: X/Y крафт-валют
- Discovered: X/Y аффиксов
- Discovered: X/Y артефактов
- Completed stakes: X/7
- Completed challenges: X/Y

Это даёт completionist-игрокам цель для долгосрочной игры.

---

## 10. Технические требования

**Движок разработки:** Unity 6 с DOTS (Entity Component System)

Выбор Unity DOTS обусловлен необходимостью обрабатывать большое количество врагов и снарядов одновременно с высокой производительностью.

**Целевая платформа:** PC (Windows), дистрибуция через Steam.

**Производительность:** Целевой показатель — стабильные 60 FPS даже при большом количестве врагов на экране. Это критично для жанра, где на арене могут находиться десятки врагов одновременно.

---

## 11. Визуальный стиль

*Визуальный стиль пока не определён и будет проработан в процессе разработки.*

---

## 12. Открытые вопросы

Следующие аспекты требуют дальнейшей проработки:

- Визуальный стиль игры
- Точный баланс: сколько золота даётся за волну, как это скейлится к поздним волнам
- Количество волн в успешном ране (20? 30? больше?)
- Точный лимит аффиксов на заклинании, система имплиситов и энчантов
- Будут ли rare/elite враги с дополнительными модификаторами
- Количество уникальных боссов и их механики

---

## 13. Заметки

*Пространство для дополнительных идей и заметок по ходу разработки.*
